# æ™ºèƒ½å›¾ç‰‡çˆ¬è™«åˆ†å¸ƒå¼é«˜å¯ç”¨ç³»ç»Ÿ

![Python](https://img.shields.io/badge/python-3.8+-blue.svg)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.110+-green.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Status](https://img.shields.io/badge/status-ç”Ÿäº§å°±ç»ª-brightgreen.svg)

ä¸€ä¸ªä¼ä¸šçº§çš„æ™ºèƒ½å›¾ç‰‡çˆ¬è™«ç³»ç»Ÿï¼Œå…·å¤‡åˆ†å¸ƒå¼é«˜å¯ç”¨æ¶æ„ã€è‡ªåŠ¨æ•…éšœè½¬ç§»ã€å®æ—¶æ•°æ®åŒæ­¥ç­‰ç‰¹æ€§ã€‚ä¸“ä¸ºå¤§è§„æ¨¡å›¾ç‰‡é‡‡é›†å’Œç®¡ç†è€Œè®¾è®¡ï¼Œæ”¯æŒè·¨æœåŠ¡å™¨éƒ¨ç½²å’Œå®¹ç¾æ¢å¤ã€‚

## ğŸŒŸ ç³»ç»Ÿç‰¹è‰²

### ğŸ—ï¸ åˆ†å¸ƒå¼é«˜å¯ç”¨æ¶æ„
- **åŒæœºçƒ­å¤‡**: ä¸»å¤‡PostgreSQLæ•°æ®åº“è‡ªåŠ¨åŒæ­¥
- **è‡ªåŠ¨æ•…éšœè½¬ç§»**: ä¸»æ•°æ®åº“æ•…éšœæ—¶ç§’çº§åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“
- **å®æ—¶å¥åº·ç›‘æ§**: æŒç»­ç›‘æ§æ•°æ®åº“å’ŒæœåŠ¡çŠ¶æ€
- **æ•°æ®ä¸€è‡´æ€§**: ç¡®ä¿ä¸»å¤‡æ•°æ®åº“æ•°æ®å®Œå…¨ä¸€è‡´
- **é›¶åœæœºç»´æŠ¤**: æ”¯æŒåœ¨çº¿ç»´æŠ¤å’Œå‡çº§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§
- **ğŸ•·ï¸ æ™ºèƒ½çˆ¬è™«å¼•æ“**: æ”¯æŒå¤šç§ç½‘ç«™çš„å›¾ç‰‡çˆ¬å–ï¼Œæ™ºèƒ½URLè§£æå’Œé€’å½’çˆ¬å–
- **ğŸ·ï¸ AIæ™ºèƒ½åˆ†ç±»**: åŸºäºå†…å®¹ã€å°ºå¯¸ã€è´¨é‡çš„å¤šç»´åº¦è‡ªåŠ¨åˆ†ç±»ç³»ç»Ÿ
- **âš¡ å¼‚æ­¥é«˜å¹¶å‘**: åŸºäºasyncioçš„é«˜æ€§èƒ½å¼‚æ­¥å¤„ç†æ¶æ„ï¼Œæ”¯æŒæ•°åƒå¹¶å‘
- **ğŸ›¡ï¸ åçˆ¬è™«æœºåˆ¶**: User-Agentè½®æ¢ã€ä»£ç†æ”¯æŒã€æ™ºèƒ½å»¶è¿Ÿæ§åˆ¶
- **ğŸ“Š å®æ—¶ç›‘æ§**: Webç•Œé¢ç›‘æ§ã€APIçŠ¶æ€æŸ¥è¯¢ã€è¯¦ç»†æ—¥å¿—åˆ†æ
- **ğŸ—„ï¸ å¤šæ•°æ®åº“æ”¯æŒ**: PostgreSQLé›†ç¾¤ + SQLiteæœ¬åœ°ç¼“å­˜
- **ğŸ”§ çµæ´»é…ç½®**: YAMLé…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€åŠ¨æ€é…ç½®æ›´æ–°
- **ğŸ’¾ è‡ªåŠ¨å¤‡ä»½**: å®šæ—¶æ•°æ®å¤‡ä»½å’Œä¸€é”®æ¢å¤æœºåˆ¶

### ğŸŒ åˆ†å¸ƒå¼éƒ¨ç½²æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸»æœåŠ¡å™¨              â”‚    â”‚        å¤‡æœåŠ¡å™¨              â”‚
â”‚    113.29.231.99           â”‚â—„â”€â”€â–ºâ”‚    113.29.232.245          â”‚
â”‚                            â”‚    â”‚                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   PostgreSQL 16         â”‚ â”‚    â”‚ â”‚   PostgreSQL 16         â”‚ â”‚
â”‚ â”‚   (Primary Database)    â”‚ â”‚    â”‚ â”‚   (Backup Database)     â”‚ â”‚
â”‚ â”‚   Port: 5432           â”‚ â”‚    â”‚ â”‚   Port: 5432           â”‚ â”‚
â”‚ â”‚   å®æ—¶æ•°æ®åŒæ­¥           â”‚ â”‚    â”‚ â”‚   è‡ªåŠ¨æ•…éšœæ¥ç®¡          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚    â”‚                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   HAç®¡ç†å™¨              â”‚ â”‚    â”‚ â”‚   HAç®¡ç†å™¨              â”‚ â”‚
â”‚ â”‚   - å¥åº·ç›‘æ§            â”‚ â”‚    â”‚ â”‚   - çŠ¶æ€åŒæ­¥            â”‚ â”‚
â”‚ â”‚   - æ•…éšœæ£€æµ‹            â”‚ â”‚    â”‚ â”‚   - å¤‡ä»½ç®¡ç†            â”‚ â”‚
â”‚ â”‚   - API: 8001          â”‚ â”‚    â”‚ â”‚   - API: 8001          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚    â”‚                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   çˆ¬è™«APIæœåŠ¡           â”‚ â”‚    â”‚ â”‚   æ–‡ä»¶åŒæ­¥æœåŠ¡          â”‚ â”‚
â”‚ â”‚   - å›¾ç‰‡çˆ¬å–            â”‚ â”‚    â”‚ â”‚   - å›¾ç‰‡æ–‡ä»¶åŒæ­¥        â”‚ â”‚
â”‚ â”‚   - æ™ºèƒ½åˆ†ç±»            â”‚ â”‚    â”‚ â”‚   - æ•°æ®å¤‡ä»½            â”‚ â”‚
â”‚ â”‚   - Port: 8000         â”‚ â”‚    â”‚ â”‚   - çŠ¶æ€ç›‘æ§            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ ¸å¿ƒ
- **Python 3.8+**: ä¸»è¦å¼€å‘è¯­è¨€
- **FastAPI**: ç°ä»£åŒ–çš„Web APIæ¡†æ¶
- **SQLAlchemy 2.0**: å¼ºå¤§çš„ORMæ¡†æ¶
- **asyncio/aiohttp**: å¼‚æ­¥ç¼–ç¨‹å’ŒHTTPå®¢æˆ·ç«¯
- **PostgreSQL 16**: ä¼ä¸šçº§å…³ç³»æ•°æ®åº“

### çˆ¬è™«å¼•æ“
- **BeautifulSoup4**: HTMLè§£æå’Œæ•°æ®æå–
- **Scrapy**: ä¸“ä¸šçš„ç½‘ç»œçˆ¬è™«æ¡†æ¶
- **requests**: HTTPè¯·æ±‚åº“
- **fake-useragent**: User-Agentä¼ªè£…

### å›¾ç‰‡å¤„ç†
- **Pillow**: å›¾ç‰‡å¤„ç†å’Œæ ¼å¼è½¬æ¢
- **OpenCV**: è®¡ç®—æœºè§†è§‰å’Œå›¾åƒåˆ†æ
- **hashlib**: å›¾ç‰‡å»é‡å’Œå®Œæ•´æ€§æ ¡éªŒ

### ç›‘æ§å’Œæ—¥å¿—
- **loguru**: é«˜çº§æ—¥å¿—ç®¡ç†
- **uvicorn**: ASGIæœåŠ¡å™¨
- **pyyaml**: é…ç½®æ–‡ä»¶ç®¡ç†

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç³»ç»Ÿè¦æ±‚

#### ç¡¬ä»¶è¦æ±‚
- **CPU**: 2æ ¸å¿ƒä»¥ä¸Š
- **å†…å­˜**: 4GB RAM (æ¨è8GB)
- **å­˜å‚¨**: 20GBå¯ç”¨ç©ºé—´ (ç”¨äºå›¾ç‰‡å­˜å‚¨)
- **ç½‘ç»œ**: ç¨³å®šçš„äº’è”ç½‘è¿æ¥

#### è½¯ä»¶è¦æ±‚
- **Python**: 3.8+ (æ¨è3.11)
- **PostgreSQL**: 16+ (ä¸¤å°æœåŠ¡å™¨)
- **æ“ä½œç³»ç»Ÿ**: Windows/Linux/macOS

#### æœåŠ¡å™¨é…ç½®
- **ä¸»æœåŠ¡å™¨**: 113.29.231.99:5432 (PostgreSQL)
- **å¤‡æœåŠ¡å™¨**: 113.29.232.245:5432 (PostgreSQL)
- **ç”¨æˆ·å**: postgres
- **å¯†ç **: Abcdefg6
- **æ•°æ®åº“**: image_crawler

### ğŸ“¦ å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®
```bash
git clone <repository-url>
cd image_crawler
```

#### 2. å®‰è£…ä¾èµ–
æ¨èä½¿ç”¨æˆ‘ä»¬æä¾›çš„å®‰è£…è„šæœ¬ï¼Œå¯ä»¥è‡ªåŠ¨å¤„ç†ç¼–ç é—®é¢˜ï¼š

```bash
python install.py
```

æˆ–è€…æ‰‹åŠ¨å®‰è£…ï¼š
```bash
pip install -r requirements.txt
```

#### 3. æ•°æ®åº“åˆå§‹åŒ–
ç³»ç»Ÿä¼šè‡ªåŠ¨è¿æ¥åˆ°é…ç½®çš„PostgreSQLæœåŠ¡å™¨ï¼Œé¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå¿…è¦çš„è¡¨ç»“æ„ï¼š

```bash
# åˆå§‹åŒ–PostgreSQLæ•°æ®åº“
python setup_postgresql_databases.py
```

#### 4. é…ç½®éªŒè¯
ç³»ç»Ÿä½¿ç”¨é¢„é…ç½®çš„åˆ†å¸ƒå¼é«˜å¯ç”¨é…ç½®æ–‡ä»¶ `config/distributed_ha_config.yaml`ï¼š


````yaml
# æœ¬åœ°èŠ‚ç‚¹é…ç½®
local_node: "primary_node"

# æ•°æ®åº“èŠ‚ç‚¹é…ç½®
nodes:
  primary_node:
    name: "primary_node"
    role: "primary"
    server:
      host: "113.29.231.99"
      port: 5432
    database_url: "postgresql://postgres:Abcdefg6@113.29.231.99:5432/image_crawler"

  backup_node:
    name: "backup_node"
    role: "secondary"
    server:
      host: "113.29.232.245"
      port: 5432
    database_url: "postgresql://postgres:Abcdefg6@113.29.232.245:5432/image_crawler"
````

### ğŸ¯ ç³»ç»Ÿå¯åŠ¨

#### å¯åŠ¨åˆ†å¸ƒå¼é«˜å¯ç”¨ç³»ç»Ÿ (æ¨è)

ä½¿ç”¨ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶å¯åŠ¨å®Œæ•´çš„é«˜å¯ç”¨ç³»ç»Ÿï¼š

```bash
python start_simple_ha.py
```

**å¯åŠ¨è¿‡ç¨‹è¯´æ˜**ï¼š
1. **è¿æ¥æµ‹è¯•**: è‡ªåŠ¨æµ‹è¯•ä¸¤å°PostgreSQLæœåŠ¡å™¨è¿æ¥
2. **é…ç½®åŠ è½½**: åŠ è½½åˆ†å¸ƒå¼é«˜å¯ç”¨é…ç½®
3. **HAç®¡ç†å™¨**: å¯åŠ¨é«˜å¯ç”¨ç®¡ç†å™¨ï¼Œç›‘æ§æ•°æ®åº“çŠ¶æ€
4. **APIæœåŠ¡**: å¯åŠ¨HAç®¡ç†API (ç«¯å£8001) å’Œä¸»åº”ç”¨API (ç«¯å£8000)
5. **çŠ¶æ€æ˜¾ç¤º**: æ˜¾ç¤ºç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œè®¿é—®åœ°å€

**å¯åŠ¨æˆåŠŸè¾“å‡ºç¤ºä¾‹**ï¼š
```
PostgreSQLåˆ†å¸ƒå¼é«˜å¯ç”¨æ•°æ®åº“ç³»ç»Ÿ
============================================================
ä¸»æ•°æ®åº“: 113.29.231.99:5432
å¤‡æ•°æ®åº“: 113.29.232.245:5432
============================================================

æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡

å¯åŠ¨PostgreSQLåˆ†å¸ƒå¼é«˜å¯ç”¨æ•°æ®åº“ç³»ç»Ÿ
============================================================
åŠ è½½é…ç½®æ–‡ä»¶...
é…ç½®åŠ è½½æˆåŠŸï¼Œæœ¬åœ°èŠ‚ç‚¹: primary_node
å‘ç° 2 ä¸ªæ•°æ®åº“èŠ‚ç‚¹
åˆå§‹åŒ–HAç®¡ç†å™¨...
HAç®¡ç†å™¨å¯åŠ¨æˆåŠŸï¼Œå½“å‰ä¸»èŠ‚ç‚¹: primary_node
å¯åŠ¨HA APIæœåŠ¡å™¨...
HA APIæœåŠ¡å™¨å¯åŠ¨æˆåŠŸ (ç«¯å£: 8001)
å¯åŠ¨ä¸»åº”ç”¨APIæœåŠ¡å™¨...
ä¸»APIæœåŠ¡å™¨å¯åŠ¨æˆåŠŸ (ç«¯å£: 8000)

============================================================
PostgreSQLåˆ†å¸ƒå¼é«˜å¯ç”¨æ•°æ®åº“ç³»ç»ŸçŠ¶æ€
============================================================
å½“å‰ä¸»èŠ‚ç‚¹: primary_node
æœ¬åœ°èŠ‚ç‚¹: primary_node
ç›‘æ§çŠ¶æ€: è¿è¡Œä¸­
åŒæ­¥é˜Ÿåˆ—: 0 ä¸ªæ“ä½œ

æ•°æ®åº“èŠ‚ç‚¹:
  ä¸»èŠ‚ç‚¹: primary_node
    çŠ¶æ€: å¥åº·
    æœåŠ¡å™¨: 113.29.231.99:5432
    ä¼˜å…ˆçº§: 1

  å¤‡èŠ‚ç‚¹: backup_node
    çŠ¶æ€: å¥åº·
    æœåŠ¡å™¨: 113.29.232.245:5432
    ä¼˜å…ˆçº§: 2

APIæœåŠ¡:
  ä¸»åº”ç”¨: http://localhost:8000
  HAç®¡ç†: http://localhost:8001/api/status
  é›†ç¾¤çŠ¶æ€: http://localhost:8000/api/ha-status
============================================================

ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼
æŒ‰ Ctrl+C åœæ­¢ç³»ç»Ÿ
```

#### å…¶ä»–å¯åŠ¨æ–¹å¼

**ç®€å•æ¨¡å¼ (å•æœºSQLite)**:
```bash
# å‘½ä»¤è¡Œæ¨¡å¼
python main.py crawl https://example.com

# äº¤äº’å¼æ¨¡å¼
python run.py
```

**ç¾éš¾æ¢å¤æ¨¡å¼**:
```bash
# å¯åŠ¨ç¾éš¾æ¢å¤ç³»ç»Ÿ
python disaster_recovery.py
```

### ğŸŒ ç³»ç»Ÿè®¿é—®åœ°å€

ç³»ç»Ÿå¯åŠ¨åï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| **ä¸»åº”ç”¨API** | http://localhost:8000 | çˆ¬è™«æ ¸å¿ƒåŠŸèƒ½API |
| **HAç®¡ç†API** | http://localhost:8001 | é«˜å¯ç”¨ç®¡ç†å’Œç›‘æ§API |
| **Webç•Œé¢** | http://localhost:8000/frontend/ | å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ |
| **APIæ–‡æ¡£** | http://localhost:8000/docs | è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£ |
| **é›†ç¾¤çŠ¶æ€** | http://localhost:8000/api/ha-status | é›†ç¾¤çŠ¶æ€æŸ¥è¯¢ |
| **å¥åº·æ£€æŸ¥** | http://localhost:8001/api/status | è¯¦ç»†å¥åº·çŠ¶æ€ |

## ğŸ“¡ APIæ¥å£è¯¦è§£

### ä¸»åº”ç”¨API (ç«¯å£8000)

#### çˆ¬è™«æ§åˆ¶æ¥å£
```bash
# å¯åŠ¨çˆ¬å–ä»»åŠ¡
POST /api/crawl
{
    "url": "https://example.com",
    "max_images": 100,
    "max_depth": 2,
    "categories": ["nature", "technology"]
}

# æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
GET /api/status/{task_id}

# è·å–çˆ¬å–ç»“æœ
GET /api/results/{task_id}

# åœæ­¢çˆ¬å–ä»»åŠ¡
POST /api/stop/{task_id}
```

#### å›¾ç‰‡ç®¡ç†æ¥å£
```bash
# è·å–å›¾ç‰‡åˆ—è¡¨
GET /api/images?page=1&limit=20&category=nature

# è·å–å›¾ç‰‡è¯¦æƒ…
GET /api/images/{image_id}

# ä¸‹è½½å›¾ç‰‡
GET /api/images/{image_id}/download

# åˆ é™¤å›¾ç‰‡
DELETE /api/images/{image_id}
```

#### ç³»ç»ŸçŠ¶æ€æ¥å£
```bash
# è·å–ç³»ç»ŸçŠ¶æ€
GET /api/system-status

# è·å–HAé›†ç¾¤çŠ¶æ€
GET /api/ha-status

# è·å–ç»Ÿè®¡ä¿¡æ¯
GET /api/statistics
```

### HAç®¡ç†API (ç«¯å£8001)

#### é›†ç¾¤ç®¡ç†æ¥å£
```bash
# è·å–è¯¦ç»†é›†ç¾¤çŠ¶æ€
GET /api/status

# æ‰‹åŠ¨æ•…éšœè½¬ç§»
POST /api/failover

# è·å–èŠ‚ç‚¹ä¿¡æ¯
GET /api/nodes

# è·å–åŒæ­¥çŠ¶æ€
GET /api/sync-status
```

#### å¤‡ä»½ç®¡ç†æ¥å£
```bash
# åˆ›å»ºå¤‡ä»½
POST /api/backup

# è·å–å¤‡ä»½åˆ—è¡¨
GET /api/backups

# æ¢å¤å¤‡ä»½
POST /api/restore/{backup_id}
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
image_crawler/
â”œâ”€â”€ ğŸ“ config/                      # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ distributed_ha_config.yaml  # åˆ†å¸ƒå¼HAé…ç½®
â”‚   â”œâ”€â”€ ha_config_loader.py         # é…ç½®åŠ è½½å™¨
â”‚   â””â”€â”€ settings.py                 # ç³»ç»Ÿè®¾ç½®
â”œâ”€â”€ ğŸ“ crawler/                     # çˆ¬è™«æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ ğŸ“ core/                    # æ ¸å¿ƒç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ async_crawler.py        # å¼‚æ­¥çˆ¬è™«
â”‚   â”‚   â”œâ”€â”€ spider.py               # ç½‘é¡µçˆ¬å–
â”‚   â”‚   â””â”€â”€ downloader.py           # å›¾ç‰‡ä¸‹è½½
â”‚   â”œâ”€â”€ ğŸ“ handlers/                # å¤„ç†å™¨
â”‚   â”œâ”€â”€ ğŸ“ utils/                   # å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ main_crawler.py             # ä¸»çˆ¬è™«ç±»
â”œâ”€â”€ ğŸ“ database/                    # æ•°æ®åº“ç®¡ç†
â”‚   â”œâ”€â”€ ğŸ“ models/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ base.py                 # åŸºç¡€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ image.py                # å›¾ç‰‡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ crawl_session.py        # çˆ¬å–ä¼šè¯
â”‚   â”œâ”€â”€ distributed_ha_manager.py   # åˆ†å¸ƒå¼HAç®¡ç†å™¨
â”‚   â”œâ”€â”€ backup_manager.py           # å¤‡ä»½ç®¡ç†å™¨
â”‚   â”œâ”€â”€ health_monitor.py           # å¥åº·ç›‘æ§
â”‚   â””â”€â”€ ha_api_server.py            # HA APIæœåŠ¡å™¨
â”œâ”€â”€ ğŸ“ storage/                     # å­˜å‚¨ç®¡ç†
â”‚   â”œâ”€â”€ distributed_file_manager.py # åˆ†å¸ƒå¼æ–‡ä»¶ç®¡ç†
â”‚   â””â”€â”€ file_sync_api.py            # æ–‡ä»¶åŒæ­¥API
â”œâ”€â”€ ğŸ“ frontend/                    # Webç•Œé¢
â”‚   â”œâ”€â”€ index.html                  # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ script.js                   # å‰ç«¯è„šæœ¬
â”‚   â””â”€â”€ style.css                   # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ ğŸ“ logs/                        # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ ğŸ“ data/                        # æ•°æ®å­˜å‚¨
â”œâ”€â”€ ğŸ“ backups/                     # æ•°æ®å¤‡ä»½
â”œâ”€â”€ ğŸ“ tests/                       # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ ğŸ“ docs/                        # æ–‡æ¡£
â”œâ”€â”€ ğŸ“ examples/                    # ç¤ºä¾‹ä»£ç 
â”œâ”€â”€ ğŸš€ start_simple_ha.py           # ç³»ç»Ÿå¯åŠ¨æ–‡ä»¶ (ä¸»è¦å…¥å£)
â”œâ”€â”€ api.py                          # FastAPIåº”ç”¨
â”œâ”€â”€ main.py                         # å‘½ä»¤è¡Œå…¥å£
â”œâ”€â”€ run.py                          # äº¤äº’å¼å…¥å£
â”œâ”€â”€ disaster_recovery.py            # ç¾éš¾æ¢å¤
â”œâ”€â”€ requirements.txt                # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬çˆ¬å–ç¤ºä¾‹

#### 1. é€šè¿‡APIå¯åŠ¨çˆ¬å–
```bash
# ä½¿ç”¨curlå¯åŠ¨çˆ¬å–ä»»åŠ¡
curl -X POST "http://localhost:8000/api/crawl" \
     -H "Content-Type: application/json" \
     -d '{
       "url": "https://example.com",
       "max_images": 50,
       "max_depth": 2,
       "download_images": true
     }'
```

#### 2. Python APIè°ƒç”¨
```python
import asyncio
import aiohttp

async def start_crawl():
    async with aiohttp.ClientSession() as session:
        data = {
            "url": "https://example.com",
            "max_images": 100,
            "max_depth": 3,
            "categories": ["nature", "technology"]
        }
        async with session.post("http://localhost:8000/api/crawl", json=data) as resp:
            result = await resp.json()
            task_id = result["task_id"]
            print(f"çˆ¬å–ä»»åŠ¡å·²å¯åŠ¨ï¼Œä»»åŠ¡ID: {task_id}")
            return task_id

# è¿è¡Œç¤ºä¾‹
task_id = asyncio.run(start_crawl())
```

#### 3. ç›‘æ§çˆ¬å–è¿›åº¦
```python
import asyncio
import aiohttp

async def monitor_task(task_id):
    async with aiohttp.ClientSession() as session:
        while True:
            async with session.get(f"http://localhost:8000/api/status/{task_id}") as resp:
                status = await resp.json()
                print(f"è¿›åº¦: {status['progress']}%, å·²ä¸‹è½½: {status['downloaded_count']}å¼ ")

                if status['status'] == 'completed':
                    print("çˆ¬å–å®Œæˆï¼")
                    break
                elif status['status'] == 'failed':
                    print(f"çˆ¬å–å¤±è´¥: {status['error']}")
                    break

            await asyncio.sleep(5)  # æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡

# ç›‘æ§ä»»åŠ¡
asyncio.run(monitor_task(task_id))
```

### é«˜å¯ç”¨åŠŸèƒ½ç¤ºä¾‹

#### 1. æŸ¥è¯¢é›†ç¾¤çŠ¶æ€
```bash
# è·å–HAé›†ç¾¤çŠ¶æ€
curl http://localhost:8001/api/status

# è·å–ç®€è¦çŠ¶æ€
curl http://localhost:8000/api/ha-status
```

#### 2. æ‰‹åŠ¨æ•…éšœè½¬ç§»
```bash
# è§¦å‘ä¸»å¤‡åˆ‡æ¢
curl -X POST http://localhost:8001/api/failover
```

#### 3. åˆ›å»ºæ•°æ®å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½
curl -X POST http://localhost:8001/api/backup

# æŸ¥çœ‹å¤‡ä»½åˆ—è¡¨
curl http://localhost:8001/api/backups
```

## ğŸ”§ é«˜çº§é…ç½®

### æ€§èƒ½è°ƒä¼˜
```yaml
# config/distributed_ha_config.yaml
monitoring:
  health_check_interval: 5      # å¥åº·æ£€æŸ¥é—´éš”(ç§’)
  failure_threshold: 3          # æ•…éšœæ£€æµ‹é˜ˆå€¼
  auto_failover: true          # è‡ªåŠ¨æ•…éšœè½¬ç§»

synchronization:
  batch_size: 100              # æ‰¹é‡åŒæ­¥å¤§å°
  sync_interval: 1             # åŒæ­¥é—´éš”(ç§’)
  max_retry_attempts: 3        # æœ€å¤§é‡è¯•æ¬¡æ•°
```

### çˆ¬è™«é…ç½®
```yaml
crawler:
  max_concurrent_requests: 10   # æœ€å¤§å¹¶å‘è¯·æ±‚æ•°
  request_delay: 1             # è¯·æ±‚å»¶è¿Ÿ(ç§’)
  timeout: 30                  # è¯·æ±‚è¶…æ—¶(ç§’)
  max_retries: 3               # æœ€å¤§é‡è¯•æ¬¡æ•°

image_processing:
  max_file_size: "10MB"        # æœ€å¤§æ–‡ä»¶å¤§å°
  supported_formats: [".jpg", ".png", ".gif", ".webp"]
  quality_threshold: 0.7       # è´¨é‡é˜ˆå€¼
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥PostgreSQLæœåŠ¡çŠ¶æ€
systemctl status postgresql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
python test_postgresql_connection.py

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
telnet 113.29.231.99 5432
```

#### 2. ç³»ç»Ÿå¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f logs/simple_ha.log

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tulpn | grep :8000
netstat -tulpn | grep :8001

# é‡ç½®ç³»ç»ŸçŠ¶æ€
python disaster_recovery.py --reset
```

#### 3. æ•…éšœè½¬ç§»ä¸å·¥ä½œ
```bash
# æ£€æŸ¥HAç®¡ç†å™¨çŠ¶æ€
curl http://localhost:8001/api/status

# æ‰‹åŠ¨è§¦å‘æ•…éšœè½¬ç§»
curl -X POST http://localhost:8001/api/failover

# æŸ¥çœ‹HAæ—¥å¿—
tail -f logs/ha_system.log
```

#### 4. å›¾ç‰‡ä¸‹è½½å¤±è´¥
```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping google.com

# æµ‹è¯•ç›®æ ‡ç½‘ç«™
curl -I https://example.com

# æŸ¥çœ‹çˆ¬è™«æ—¥å¿—
tail -f logs/crawler.log
```

### æ—¥å¿—æ–‡ä»¶è¯´æ˜
- `logs/simple_ha.log`: ç³»ç»Ÿå¯åŠ¨å’ŒHAç®¡ç†æ—¥å¿—
- `logs/crawler.log`: çˆ¬è™«è¿è¡Œæ—¥å¿—
- `logs/ha_system.log`: é«˜å¯ç”¨ç³»ç»Ÿæ—¥å¿—
- `logs/postgresql_ha.log`: PostgreSQLç›¸å…³æ—¥å¿—

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### æ€§èƒ½æŒ‡æ ‡
- **æ•°æ®åº“è¿æ¥æ•°**: ç›‘æ§æ´»è·ƒè¿æ¥æ•°é‡
- **çˆ¬å–é€Ÿåº¦**: æ¯åˆ†é’Ÿå¤„ç†çš„å›¾ç‰‡æ•°é‡
- **å­˜å‚¨ä½¿ç”¨**: ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µ
- **ç½‘ç»œå¸¦å®½**: ä¸‹è½½å¸¦å®½ä½¿ç”¨ç‡
- **ç³»ç»Ÿèµ„æº**: CPUå’Œå†…å­˜ä½¿ç”¨ç‡

### ç›‘æ§å‘½ä»¤
```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
curl http://localhost:8000/api/system-status

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
curl http://localhost:8000/api/statistics

# æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€
curl http://localhost:8001/api/status
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- ä½¿ç”¨ä¸“ç”¨çš„PostgreSQLæœåŠ¡å™¨
- é…ç½®é€‚å½“çš„é˜²ç«å¢™è§„åˆ™
- è®¾ç½®å®šæœŸæ•°æ®å¤‡ä»½
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- é…ç½®æ—¥å¿—è½®è½¬

### 2. æ€§èƒ½ä¼˜åŒ–
- æ ¹æ®ç½‘ç»œå¸¦å®½è°ƒæ•´å¹¶å‘æ•°
- ä½¿ç”¨SSDå­˜å‚¨æé«˜I/Oæ€§èƒ½
- é…ç½®æ•°æ®åº“è¿æ¥æ± 
- å¯ç”¨å›¾ç‰‡å‹ç¼©å’Œå»é‡
- ä½¿ç”¨CDNåŠ é€Ÿå›¾ç‰‡è®¿é—®

### 3. å®‰å…¨è€ƒè™‘
- ä½¿ç”¨å¼ºå¯†ç ä¿æŠ¤æ•°æ®åº“
- é™åˆ¶APIè®¿é—®æƒé™
- é…ç½®HTTPSåŠ å¯†ä¼ è¾“
- å®šæœŸæ›´æ–°ç³»ç»Ÿä¾èµ–
- ç›‘æ§å¼‚å¸¸è®¿é—®è¡Œä¸º

## ğŸ”® æœªæ¥è§„åˆ’

### å³å°†æ¨å‡ºçš„åŠŸèƒ½
- **æœºå™¨å­¦ä¹ é›†æˆ**: åŸºäºAIçš„å›¾ç‰‡å†…å®¹è¯†åˆ«å’Œåˆ†ç±»
- **åˆ†å¸ƒå¼çˆ¬å–**: æ”¯æŒå¤šæœºå™¨ååŒçˆ¬å–
- **äº‘å­˜å‚¨æ”¯æŒ**: é›†æˆAWS S3ã€é˜¿é‡Œäº‘OSSç­‰äº‘å­˜å‚¨
- **å®æ—¶ç›‘æ§é¢æ¿**: Webç•Œé¢çš„å®æ—¶ç›‘æ§å’Œç®¡ç†
- **APIé™æµ**: æ™ºèƒ½APIè®¿é—®é¢‘ç‡æ§åˆ¶
- **å›¾ç‰‡å»é‡ä¼˜åŒ–**: æ›´é«˜æ•ˆçš„é‡å¤å›¾ç‰‡æ£€æµ‹ç®—æ³•

### æ‰©å±•æ€§å¢å¼º
- **å¾®æœåŠ¡æ¶æ„**: æ‹†åˆ†ä¸ºç‹¬ç«‹çš„å¾®æœåŠ¡
- **å®¹å™¨åŒ–éƒ¨ç½²**: Dockerå’ŒKubernetesæ”¯æŒ
- **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹è´Ÿè½½å‡è¡¡
- **æ¶ˆæ¯é˜Ÿåˆ—**: å¼‚æ­¥ä»»åŠ¡å¤„ç†ä¼˜åŒ–

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. **Forké¡¹ç›®** åˆ°æ‚¨çš„GitHubè´¦æˆ·
2. **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯** (`git checkout -b feature/AmazingFeature`)
3. **æäº¤æ›´æ”¹** (`git commit -m 'Add some AmazingFeature'`)
4. **æ¨é€åˆ†æ”¯** (`git push origin feature/AmazingFeature`)
5. **åˆ›å»ºPull Request**

### å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å…‹éš†å¼€å‘ç‰ˆæœ¬
git clone https://github.com/your-username/image_crawler.git
cd image_crawler

# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements.txt
pip install -r requirements-dev.txt

# è¿è¡Œæµ‹è¯•
python -m pytest tests/

# ä»£ç æ ¼å¼åŒ–
black .
flake8 .
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) è®¸å¯è¯ã€‚

## ğŸ“ æ”¯æŒä¸è”ç³»

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/your-username/image_crawler
- **é—®é¢˜åé¦ˆ**: https://github.com/your-username/image_crawler/issues
- **æ–‡æ¡£**: https://your-username.github.io/image_crawler
- **é‚®ç®±**: support@example.com

---

## ğŸŒŸ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ï¼

**å¼€å‘å›¢é˜Ÿ**: æ™ºèƒ½å›¾ç‰‡çˆ¬è™«ç³»ç»Ÿå¼€å‘ç»„
**ç‰ˆæœ¬**: v2.0.0
**æœ€åæ›´æ–°**: 2025å¹´6æœˆ26æ—¥
**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ ç”Ÿäº§å°±ç»ª