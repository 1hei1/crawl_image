# ğŸ›¡ï¸ å®¹ç¾å¤‡ä»½ç³»ç»Ÿ

ä¸ºå›¾ç‰‡çˆ¬å–ç³»ç»Ÿå¢åŠ çš„æ•°æ®åº“å®¹ç¾å¤‡ä»½åŠŸèƒ½ï¼Œå®ç°ä¸€å°æœåŠ¡å™¨å®•æœºå¦ä¸€å°å¯ä»¥ç«‹å³æ¥ç®¡çš„é«˜å¯ç”¨æ€§æ¶æ„ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ”„ ä¸»ä»æ•°æ®åº“æ¶æ„
- âœ… æ”¯æŒå¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼ˆ1ä¸» + Nå¤‡ï¼‰
- âœ… è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ•°æ®åº“ä½œä¸ºä¸»æ•°æ®åº“
- âœ… æŒ‰ä¼˜å…ˆçº§è¿›è¡Œæ™ºèƒ½æ•…éšœè½¬ç§»
- âœ… æ”¯æŒ SQLite å’Œ PostgreSQL

### ğŸ’¾ æ™ºèƒ½å¤‡ä»½ç®¡ç†
- âœ… å®šæ—¶è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
- âœ… å¤‡ä»½æ–‡ä»¶å‹ç¼©å’Œè‡ªåŠ¨æ¸…ç†
- âœ… ä¸€é”®å¤‡ä»½æ¢å¤åŠŸèƒ½
- âœ… å¤‡ä»½å®Œæ•´æ€§éªŒè¯

### ğŸ” å®æ—¶å¥åº·ç›‘æ§
- âœ… æ•°æ®åº“è¿æ¥çŠ¶æ€ç›‘æ§
- âœ… å“åº”æ—¶é—´æ€§èƒ½ç›‘æ§
- âœ… è‡ªå®šä¹‰å‘Šè­¦è§„åˆ™
- âœ… å†å²æ•°æ®è®°å½•å’Œåˆ†æ

### âš¡ è‡ªåŠ¨æ•…éšœè½¬ç§»
- âœ… å®æ—¶æ•…éšœæ£€æµ‹
- âœ… ç§’çº§è‡ªåŠ¨åˆ‡æ¢
- âœ… é›¶é…ç½®æ™ºèƒ½é€‰æ‹©å¤‡ç”¨æ•°æ®åº“
- âœ… æ•…éšœè½¬ç§»å†å²è®°å½•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯ç”¨å®¹ç¾åŠŸèƒ½

ç¼–è¾‘ `config/config.yaml`ï¼š

```yaml
disaster_recovery:
  enabled: true
  databases:
    primary:
      name: "primary"
      type: "primary"
      priority: 0
      url: "sqlite:///data/images_primary.db"
    secondary1:
      name: "secondary1"
      type: "secondary"
      priority: 1
      url: "sqlite:///data/images_secondary1.db"
```

### 2. å¯åŠ¨ç³»ç»Ÿ

```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
python disaster_recovery.py status

# å¯åŠ¨ç›‘æ§æœåŠ¡
python disaster_recovery.py start-monitoring

# åˆ›å»ºå¤‡ä»½
python disaster_recovery.py backup
```

## ğŸ“‹ ä¸»è¦å‘½ä»¤

```bash
# ç³»ç»ŸçŠ¶æ€
python disaster_recovery.py status

# å¤‡ä»½ç®¡ç†
python disaster_recovery.py backup                    # åˆ›å»ºå¤‡ä»½
python disaster_recovery.py backup --name my_backup   # æŒ‡å®šå¤‡ä»½åç§°
python disaster_recovery.py restore backup.sql        # æ¢å¤å¤‡ä»½

# æ•…éšœè½¬ç§»
python disaster_recovery.py failover secondary1       # æ‰‹åŠ¨æ•…éšœè½¬ç§»
python disaster_recovery.py history                   # æŸ¥çœ‹è½¬ç§»å†å²

# ç›‘æ§æ§åˆ¶
python disaster_recovery.py start-monitoring          # å¯åŠ¨ç›‘æ§
python disaster_recovery.py enable-auto-failover      # å¯ç”¨è‡ªåŠ¨æ•…éšœè½¬ç§»
python disaster_recovery.py disable-auto-failover     # ç¦ç”¨è‡ªåŠ¨æ•…éšœè½¬ç§»

# è¿æ¥æµ‹è¯•
python disaster_recovery.py test                      # æµ‹è¯•æ•°æ®åº“è¿æ¥
```

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æ•°æ®åº“       â”‚    â”‚   å¤‡ç”¨æ•°æ®åº“1    â”‚    â”‚   å¤‡ç”¨æ•°æ®åº“2    â”‚
â”‚   (Primary)     â”‚    â”‚   (Secondary1)  â”‚    â”‚   (Secondary2)  â”‚
â”‚   ä¼˜å…ˆçº§: 0     â”‚    â”‚   ä¼˜å…ˆçº§: 1     â”‚    â”‚   ä¼˜å…ˆçº§: 2     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å®¹ç¾ç®¡ç†å™¨     â”‚
                    â”‚                â”‚
                    â”‚ â€¢ å¥åº·ç›‘æ§      â”‚
                    â”‚ â€¢ æ•…éšœæ£€æµ‹      â”‚
                    â”‚ â€¢ è‡ªåŠ¨åˆ‡æ¢      â”‚
                    â”‚ â€¢ å¤‡ä»½ç®¡ç†      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   åº”ç”¨ç¨‹åº       â”‚
                    â”‚  (å›¾ç‰‡çˆ¬è™«)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
image_crawler/
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ backup_manager.py      # å¤‡ä»½ç®¡ç†å™¨
â”‚   â”œâ”€â”€ health_monitor.py      # å¥åº·ç›‘æ§å™¨
â”‚   â”œâ”€â”€ failover_manager.py    # æ•…éšœè½¬ç§»ç®¡ç†å™¨
â”‚   â””â”€â”€ enhanced_manager.py    # å¢å¼ºæ•°æ®åº“ç®¡ç†å™¨
â”œâ”€â”€ tools/
â”‚   â””â”€â”€ disaster_recovery_cli.py  # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ config/
â”‚   â””â”€â”€ disaster_recovery_example.yaml  # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ DISASTER_RECOVERY.md   # è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_disaster_recovery.py  # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ disaster_recovery.py       # ç®¡ç†è„šæœ¬
```

## ğŸ”§ é…ç½®ç¤ºä¾‹

### SQLite é…ç½®
```yaml
disaster_recovery:
  enabled: true
  databases:
    primary:
      url: "sqlite:///data/images_primary.db"
    secondary1:
      url: "sqlite:///backup/images_secondary1.db"
```

### PostgreSQL é…ç½®
```yaml
disaster_recovery:
  enabled: true
  databases:
    primary:
      url: "postgresql://user:pass@localhost:5432/crawler_db"
    secondary1:
      url: "postgresql://user:pass@backup-server:5432/crawler_backup"
```

## ğŸ“Š ç›‘æ§é¢æ¿

è¿è¡Œ `python disaster_recovery.py status` æŸ¥çœ‹ï¼š

```
=== å®¹ç¾å¤‡ä»½ç³»ç»ŸçŠ¶æ€ ===
å®¹ç¾å¤‡ä»½åŠŸèƒ½: å¯ç”¨

--- æ•°æ®åº“çŠ¶æ€ ---
å½“å‰ä¸»æ•°æ®åº“: primary
è‡ªåŠ¨å¤‡ä»½: å¯ç”¨
å¥åº·ç›‘æ§: å¯ç”¨
è‡ªåŠ¨æ•…éšœè½¬ç§»: å¯ç”¨

  ğŸŸ¢ primary ğŸ‘‘
    ç±»å‹: primary
    ä¼˜å…ˆçº§: 0
    è¿æ¥çŠ¶æ€: æ­£å¸¸

  ğŸŸ¢ secondary1
    ç±»å‹: secondary
    ä¼˜å…ˆçº§: 1
    è¿æ¥çŠ¶æ€: æ­£å¸¸

--- å¥åº·çŠ¶æ€ ---
æ•´ä½“çŠ¶æ€: healthy
  primary: healthy
    å“åº”æ—¶é—´: 12.34ms
  secondary1: healthy
    å“åº”æ—¶é—´: 15.67ms

--- æ•…éšœè½¬ç§»çŠ¶æ€ ---
å½“å‰çŠ¶æ€: normal
è‡ªåŠ¨æ•…éšœè½¬ç§»: å¯ç”¨
æ£€æµ‹é˜ˆå€¼: 3
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼š

```bash
python -m pytest tests/test_disaster_recovery.py -v
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](docs/DISASTER_RECOVERY.md)
- [é…ç½®ç¤ºä¾‹](config/disaster_recovery_example.yaml)

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: å®¹ç¾åŠŸèƒ½æ— æ³•å¯ç”¨**
```bash
# æ£€æŸ¥é…ç½®
python disaster_recovery.py status
```

**Q: è‡ªåŠ¨æ•…éšœè½¬ç§»ä¸å·¥ä½œ**
```bash
# æ£€æŸ¥ç›‘æ§æœåŠ¡
python disaster_recovery.py start-monitoring
```

**Q: å¤‡ä»½åˆ›å»ºå¤±è´¥**
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
python disaster_recovery.py test
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å®šæœŸæµ‹è¯•**ï¼šå®šæœŸæ‰§è¡Œæ•…éšœè½¬ç§»æµ‹è¯•
2. **ç›‘æ§å‘Šè­¦**ï¼šé…ç½®åˆé€‚çš„å‘Šè­¦é˜ˆå€¼
3. **å¤‡ä»½éªŒè¯**ï¼šå®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§
4. **å¼‚åœ°éƒ¨ç½²**ï¼šå°†å¤‡ç”¨æ•°æ®åº“éƒ¨ç½²åœ¨ä¸åŒä½ç½®
5. **æ–‡æ¡£è®°å½•**ï¼šè®°å½•æ•…éšœè½¬ç§»æ“ä½œæµç¨‹

## ğŸ”’ å®‰å…¨è€ƒè™‘

- æ•°æ®åº“è¿æ¥ä½¿ç”¨åŠ å¯†ä¼ è¾“
- å¤‡ä»½æ–‡ä»¶æ”¯æŒå‹ç¼©å’ŒåŠ å¯†
- è®¿é—®æƒé™æ§åˆ¶å’Œå®¡è®¡æ—¥å¿—
- æ•æ„Ÿä¿¡æ¯é…ç½®æ–‡ä»¶ä¿æŠ¤

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- ç›‘æ§é¢‘ç‡å¯è°ƒèŠ‚ï¼Œé¿å…è¿‡åº¦æ£€æŸ¥
- å¤‡ä»½ç­–ç•¥å¯é…ç½®ï¼Œæ”¯æŒå¢é‡å¤‡ä»½
- æ•…éšœè½¬ç§»æ—¶é—´ä¼˜åŒ–ï¼Œæœ€å°åŒ–æœåŠ¡ä¸­æ–­
- èµ„æºä½¿ç”¨ç›‘æ§ï¼Œé¿å…å½±å“ä¸»ä¸šåŠ¡

---

**ğŸ‰ ç°åœ¨æ‚¨çš„å›¾ç‰‡çˆ¬å–ç³»ç»Ÿå·²ç»å…·å¤‡äº†ä¼ä¸šçº§çš„å®¹ç¾å¤‡ä»½èƒ½åŠ›ï¼**

å½“ä¸»æ•°æ®åº“å‡ºç°æ•…éšœæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åœ¨å‡ ç§’å†…åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®åº“ï¼Œç¡®ä¿æœåŠ¡çš„è¿ç»­æ€§å’Œæ•°æ®çš„å®‰å…¨æ€§ã€‚
